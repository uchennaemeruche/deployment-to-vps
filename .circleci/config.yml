version: 2.1
jobs:
  configure_project:
    docker: 
      - image: python:3.7-alpine3.11
    steps:
      - checkout
      - run:
          name: Show OS version
          command: |
            if [ -e /etc/os-release ]; then
              cat /etc/os-release
            elif [ -e /etc/redhat-release ]; then
              cat /etc/redhat-release
            else
              echo 'Invalid Image' 1>&2
              exit 1
            fi
      - add_ssh_keys:
          fingerprints: ["c0:04:eb:73:a2:84:bd:ad:9a:37:aa:1f:2b:07:8d:50"]
      - run:
          name: install ansible
          command: |
            apk add --update ansible
      - run:
          name: Show Ansible version
          command: ansible --version
      - run:
          name: configure and run ansible playbook
          command: |
            ansible-playbook --user=mekiostore -vvv -i inventory.txt playbook.yml 
  
workflows:
  deployment_workflow:
    jobs:
      - configure_project
